<style>
.demographics {
  border-style: solid;
  border-width: 1px;
  margin: 0 10px;
  padding: 80px 10px 5px;
  position: absolute;
  top: 30px;
  width: 96%;
  height: 20%;

  border: 2px solid;
  border-radius: 25px;
}

#patient_name {
  font-weight: bold;
  font-size: 20px;
  top: 4px;
  margin-left: 35px;
  position: absolute;
}

.gender {
  border-radius: 50%;
  border: 2px solid;
  width: 24px;
}

/* ............. div tabble ............. */

.dtable {
  top: 20px;
  position: absolute;
  width: 98%;
  display: table;
}

.drow {
  display: table-row;
}

.dcell {
  width: 100%;
  display: table-cell;
}

.name {
  border-style: solid;
  border-width: 0px 0px 1px 0px;
}

/* ........................... div table end ..... */

.table-head {
  font-weight: bold;
  width: 20%;
}

.data {
  position: absolute;
  top: 35%;
  width: 99%;
}

.table-data {
  width: 20%;
}

</style>

<%
#raise @patient_obj.inspect
%>


<div class="demographics">
  
  <div class="dtable">
    <div class="drow">
      <div class="dcell name">
        <div class="gender"><%= image_tag "male.gif", :id => 'fetched_sex' %>
        </div>&nbsp;<span id='patient_name'></span>
      </div>
    </div>
  </div>
  
  <div class="dtable data">
    <div class="drow">
      <div class="dcell table-head">Patient ID:</div>
      <div class="dcell table-data" id="nid"></div>
      <div class="dcell table-head">Duration on ART:</div>
      <div class="dcell table-data" id="duration_on_art">&nbsp;</div>
    </div>

    <div class="drow">
      <div class="dcell table-head">Filing number:</div>
      <div class="dcell table-data" id="filing_number">&nbsp;</div>
      <div class="dcell table-head">Current regimen:</div>
      <div class="dcell table-data" id="current_regimen">&nbsp;</div>
    </div>


    <div class="drow">
      <div class="dcell table-head">ARV number:</div>
      <div class="dcell table-data" id="arv_number">&nbsp;</div>
      <div class="dcell table-head">Residence:</div>
      <div class="dcell table-data" id="residence">&nbsp;</div>
    </div>

    <div class="drow">
      <div class="dcell table-head">ART start date:</div>
      <div class="dcell table-data" id="art_start_date">&nbsp;</div>
      <div class="dcell table-head">Latest VL:</div>
      <div class="dcell table-data">&nbsp;</div>
    </div>

    <div class="drow">
      <div class="dcell table-head">Current outcome:</div>
      <div class="dcell table-data" id="outcome">&nbsp;</div>
      <div class="dcell table-head">&nbsp;</div>
      <div class="dcell table-data">&nbsp;</div>
    </div>

  
  </div>



</div>


<script>


function initData() {

 jQuery.ajax({
    type: "POST",
    url: "/people/get_patient_name",
    data: "patient_id=" + "<%=params[:found_person_id]%>",
    success: function(result){
      printName(result);
    }
        
  });

}

function printName(result) {
  var data = JSON.parse(result);
  alert(data['name']);

  if(data['gender'] == 'M' || data['gender'] == 'Male') {
    var sex = 'male';
  }else{
    var sex = 'female';
  }

  document.getElementById('patient_name').innerHTML = data['name'];  
  var src_path = document.getElementById('fetched_sex');
  var current_path = src_path.src;
  src_path.src = src_path.src.replace('male', sex);  

 jQuery.ajax({
    type: "POST",
    url: "/people/get_patient_identifiers",
    data: "patient_id=" + "<%=params[:found_person_id]%>",
    success: function(result){
      printIdentifiers(result);
    }
        
  });
  
}

function printIdentifiers(result) {
  var data = JSON.parse(result);
  document.getElementById('nid').innerHTML = data['national_id'];  
  document.getElementById('filing_number').innerHTML = data['filing_number'];  
  document.getElementById('arv_number').innerHTML = data['arv_number'];  

 jQuery.ajax({
    type: "POST",
    url: "/people/get_patient_art_start_date",
    data: "patient_id=" + "<%=params[:found_person_id]%>",
    success: function(result){
      document.getElementById('art_start_date').innerHTML = JSON.parse(result)['start_date']
      printDurationOnART(JSON.parse(result)['start_date']);
    }
        
  });
}

function printDurationOnART(start_date) {
 jQuery.ajax({
    type: "POST",
    url: "/people/get_patient_duration_on_art",
    data: "start_date=" + start_date,
    success: function(result){
      document.getElementById('duration_on_art').innerHTML = JSON.parse(result)['duration']
      printCurentRegimen(); 
    }
        
  });
}

function printCurentRegimen() {
 jQuery.ajax({
    type: "POST",
    url: "/people/get_patient_current_regimen",
    data: "patient_id=" + "<%=params[:found_person_id]%>",
    success: function(result){
      document.getElementById('current_regimen').innerHTML = JSON.parse(result)['regimen']
      printCurentResidence(); 
    }
 });    
}

function printCurentResidence() {
 jQuery.ajax({
    type: "POST",
    url: "/people/get_current_address",
    data: "patient_id=" + "<%=params[:found_person_id]%>",
    success: function(result){
      document.getElementById('residence').innerHTML = JSON.parse(result)['current_residence']
    }
 });    
}

function printCurentOutcome() {
 jQuery.ajax({
    type: "POST",
    url: "/people/get_current_outcome",
    data: "patient_id=" + "<%=params[:found_person_id]%>",
    success: function(result){
      document.getElementById('outcome').innerHTML = JSON.parse(result)['outcome']
    }
 });    
}

initData();
printCurentOutcome();

</script>
